다음으로 구체적인 9+3축 모델에 대한 칼만 필터를 전개한다.

이를 위하여 시스템 모델과 측정 모델을 정의해야 한다. 먼저 system의 가장 근본이 되는 모델은 에이전트의 위치와 각도의 조합으로 이뤄지는 모델이다. 이때 위치는 자명히 3차원 유클리드 좌표계로 표현할 수 있고, 각도는 여러가지 방법으로 표현이 가능하다.

가장 간단한 방법은 오일러 각을 사용하는 것이다. 이때 오일러 각은 yaw, pitch, roll로 표현되며, 이는 각각 z, y, x축을 기준으로 회전하는 각도를 의미한다. 또한 쿼터니언(Qauternion) 역시 좋은 수학적 성질들을 많이 가지고 있어 자주 이용된다.

그런데 센서로부터 얻어진 각도를 단순히 적분하여 오일러 각을 얻어도 되는지가 의문스러워졌다. 왜냐하면 오일러 각은 그 변환을 적용하는 순서에 따라 결과가 달라지기 때문이다. 예르 들어 어떤 시스템에서 x축을 기준으로 한 각 변위가 45도가 관찰되었고 y측을 기준으로 한 각 변위가 90도가 관찰되었다고 가정해보자.
이때 점 (1, 0, 0)의 위치 변화를 관찰해본다.

이때 이것을 어떻게 해석하는지에 따라 여러 변화가 발생할 수 있다. 행렬로 생각하면 이해가 쉬운데, 어떤 축을 중심으로 회전하는 변환은 행렬로 표현되며, 그러므로 회전의 합성은 행렬곱이 되고, 행렬곱은 그 순서에 따라 결과가 다르게 되기 때문이다.

다만, 다음과 같이 각 축에 대하여 시간에 따른 미소 회전 행렬열이 주어져있다고 가정하자.

- x: $X_0, X_1, X_2, ..., X_t$
- y: $Y_0, Y_1, Y_2, ..., Y_t$
- z: $Z_0, Z_1, Z_2, ..., Z_t$

그러므로 초기 방향좌표계 행렬 $V$에 대하여 이것이 적용된 후의 행렬열은 다음과 같이 된다.

$X_0Y_0Z_0X_1Y_1Z_1...X_tY_tZ_tV$

순서가 바뀌면 다음과 같다.

$Z_0Y_0X_0Z_1Y_1X_1...Z_tY_tX_tV$

이것이 같은 곳으로 수렴하는지가 궁금하다.

이때 시간 순서가 중요한데, 왜냐하면 이는 센서로부터 얻는 각속도를 가정하는 것이고 그러므로 항상 로컬 좌표계를 기준으로 하기 때문이다.

물론 이것은 짧은 시간 단위에 대하여 수렴할 것으로 생각되며, 그러므로 이것은 약간 bias된 노이즈로 생각할 수 있다. 즉, 크게 중요한 값이 아니다.

오일러 각을 단순히 적분한다고 가정해보자. 그러면 이것은 자명히 순서에 무관하다. 그러나 이것은 실제 물리적인 위치와 매우 다른 결과를 낳게 된다. 예를 들어 x축을 기준으로 물체가 180도 회전하였다. 그리고 z축을 기준으로 물체가 회전한다고 하면, 단순히 적분할 때는 이것은 시계방향의 회전이지만 실제로는 반시계방향의 회전이다.

---

그런데 이때 중요한 것은 각속도보다는 각도다. 왜냐하면 우리가 표현하고자 하는 시스템은 물리 시스템이며, 그러므로 실제로 행렬에서 어떤 수학적인 내용이 성립하느냐와 관계 없이 수학은 단순히 그것을 표현할 수 있는 도구에 불과하고, 중요한 것은 물리적인 변화이기 때문이다.

시스템의 확실한 시각화와 이해를 위하여 유클리드 정규직교기저의 운동으로 시스템의 방향을 표현할 것이다.

그리고 라그랑주 역학을 사용하여 시스템을 분석해보자.

먼저 어떤 시스템이 기준점 $p$를 중심으로 적절한 변위 $d_0, d_1, d_2, ..., d_n$만큼 떨어져서 질량 $m_0, m_1, m_2, ..., m_n$을 가지고 있다고 가정하자. 그리고 회전변환 $R$에 의하여 시스템의 위치와 방향이 정의된다고 하자. 즉, 각 질량점 $x_0, x_1, x_2, ..., x_n$은 다음과 같이 정의된다.

$$
x_0 = Rd_0 + p \\
x_1 = Rd_1 + p \\
x_2 = Rd_2 + p \\
\vdots \\
x_n = Rd_n + p
$$

각 벡터를 열벡터로 가지는 행렬 형식으로 표현하면 아래와 같다.

$$
X = RD + p
$$

그러므로 운동 에너지는

$$
\begin{align*}
e_k &= \bold{1}_3^T \frac{1}{2}\dot{X}^2M \bold{1}_n\\
&= \bold{1}_3^T \frac{1}{2}\left(\dot{R}D + \dot{p}\right)^2M \bold{1}_n
\end{align*}
$$

- $\bold{1}_3$: $(1, 1, 1)$
- $M$: 질량행렬, 대각성분이 질량인 $n \times n$ 행렬
- $\dot{X}$: $X$의 시간에 대한 미분
- $^2$: element-wise square
- $\bold{1}_n$: $n$차원 1벡터, $(1, 1, ..., 1)$

---

어떠한 시스템에서 긴 시간 동안의 자세 변화는 하나의 축에 대한 회전으로 간주할 수 없다. 심지어 외력이 없는 경우라도 이것은 명확한데, 왜냐하면 회전축 자체가 바뀌기 때문이다. 수학적으로 회전이란 근본적으로 그 축은 바뀌어서는 안 되는 것이다.

그러나 국소적으로는 하나의 축에 대한 회전으로 이것을 간주할 수가 있다. 이것은 단일한 행렬이므로 수학적으로 다루기가 무척 용이하다. 그러므로 알아야 하는 것은 각속도게값으로부터 이것을 하나의 축에 대한 것으로 복원하는 것이며, 이것을 알기 위해서는 하나의 축을 기준으로 한 회전이 발생할 때 각속도게에서 어떤 값을 읽는지를 알 필요가 있다는 것이다.

이를 위해서, 예를 들어 (1,1,1)이라는 축을 기준으로 한 회전이 있다고 할 때 이것이 어떤 값을 읽는지를 알아보면 좋을 것이다.
직관적으로 생각하기에는, 뭔가 회전을 축 방향으로 사영한 후에 해석하면 될 것 같기는 하다. 이것은 적어도 측정 방향과 회전 방향이 직교하는 경우와 측정 방향과 회전 방향이 일치하는 경우에 대해서는 직관적이다

---

중요한 것은 이 센서가 무엇을 측정하는가 하는 점이다. 먼저 센서 측정값의 가정은 이렇다. 센서의 각 축이 측정하는 것은, 회전을 사영한 경우의 회전각이라는 것이다.

이것이 맞는지는 구체적으로 센서의 작동 원리로부터 파악해야 한다.
센서의 작동 원리는 코리올리 효과에 기반한 것으로, rotating frame에서 linear motion을 하는 object가 있으면 rotating axis와 velocity에 모두 직교하는, 그리고 이 둘의 크기에 비례하는, 즉 이 둘의 외적으로 주어지는 방향으로 힘을 받는다는 것이다.

물론 v, F를 알 때 vw=F를 만족하는 w는 무수히 많으므로 한 축의 정보만 가지고서는 회전을 측정할 수가 없고, 적어도 두 개 이상의 축이 필요하게 된다. 또한 센서 역시 v와 수직인 모든 방향의 힘을 측정할 수 있는 것이 아니고 v와 수직인 방향들 중 한 방향으로의 힘만 측정이 가능할 것이므로, 이러한 센서는 적어도 3개가 필요하다는 것을 알게 된다.

즉, v(elocity) 축과 m(easurment)축에 대하여, 실제로 측정되는 값은 (vxf)m, 즉 삼중곱이 된다는 이야기다. 그러므로 선형 독립인 이러한 센서 세 개가 있어야 정확한 측정이 가능하다. 즉, 정리하자면, 그러므로 센서가 반환하는 값은 실제로 축 방향으로의 회전의 사영이 된다는 것이고, 그것은 별도의 복잡한 계산 없이 코리올리 힘이 그러한 방식으로 작용하기 때문에 가능하다는 결론에 이른다.

그러므로 이러한 방식으로부터 회전 행렬을 결정하는 것은 그저 다시 벡터를 구성하는 것에 지나지 않으며, Rodrigues' rotation formula와 같은 방법으로 이를 구할 수 있다.

---

이제 회전과 그것이 측정되는 방법에 대해 완전히 이해하였으므로 다음으로 중요한 것은 가속도에 대해 이해하는 것이다. 특히 가속도를 입력, 즉 일반적으로 u 벡터로 표현되는 그것으로 인식할 것인지 아니면 그것을 측정값으로 인식할 것인지는 중요한 문제가 된다. 또한 그것이 수학적으로 같은 결론에 도달하는지도 알아보아야 한다. 일단 접근 방식 자체는 다른데, 궁극적인 차이는 이것을 외부 입력으로 가정하는 경우 입력 범위의 제한도 없고 어떠한 통계적인 가정도 필요가 없지만 이것을 시스템 측정으로 가정하는 경우 측정값의 사전 분포에 대한 지식이 필요하다는 것이다.

이때 혼란스러운 부분은 ChatGPT를 참고하였을 때 가속도와 각속도를 시스템의 입력으로 간주하였다는 것으로, 이것은 실제로는 시스템의 입력이 아니라 측정값임이 분명하기 때문이다. 그런데 이것을 다르게 생각해보자면 모터의 입력 역시 어떻게 생각하면 모터에 특정한 힘을 가한 것이 아니라 모터에 가해준 전류의 측정값으로도 생각할 수 있다는 점이 흥미롭다.

정리하자면, 지금 혼란을 느끼는 부분은 센서로부터의 측정값과 제어 입력이 있을 때 이것 중 어떤 값들을 제어 입력으로 간주해야 하고 어떤 것들을 측정값으로 간주해야 하는지다. 물론 제어 입력은 전부 제어 입력을로 간주해도 되겠지만, 센서 입력 중에서도 제어 입력으로 사용되는 부분이 있기 때문이다.

만약 시스템 모델과 측정 모델이 다음과 같이 주어진다고 하자.

$$
\begin{align*}
s_{t+1} &= As_t + Bu_t + w_t \\
y_t &= Cs_t + v_t
\end{align*}
$$

---

먼저 적어도 6축 센서를 이용하여 어렵지 않게 세로 각도를 측정할 수 있음을 보였다. 그런에 이때 이 측정 term에는 다음과 같은 unknown term들이 존재한다.

- 회전 반지름
- 중력가속도
- 각속도/가속도 편차(bias)
- 각속도/가속도 스케일

이제 이러한 값들을 여러 방법들을 통하여 결정할 수 있는지가 관건이다.

먼저 다음과 같은 두 가지 사실을 고려한다.

- 우리가 알고 있는 것은 오직 관찰 값뿐이다.
- 이 관찰 값은 결정론적이거나 정밀한 것이 아니며, 오차가 포함되어있고 비결정론적일 수 있다. 즉, 실제 state가 같더라도 오차로 인해 다른 관찰값을 얻을 수 있다.

이것이 함의하는 바는, 결국 이러한 모델에서 시스템 모델과 측정 모델을 결정하는 것은 확률분포의 샘플로부터 모수를 추정하는 것과 같은 접근방법을 사용할 수 있다는 것이다.
물론 이때는 모수를 결정하는 것이 대단히 중요한데, 이 경우 모수란 다음과 같은 것들을 의미한다.

- 시스템 모델
- 측정 모델
- 초기 상태

여기에서 한번 베이즈 정리를 적용해보자. 모수 $\theta$가 주어질 때, 이것으로부터 관찰값 y가 주어질 확률은 $P(y|\theta)$이다.
여기서 베이즈 정리를 그대로 적용해보면 다음과 같다.

$$
P(\theta|y) = \frac{P(y|\theta)P(\theta)}{P(y)}
$$

이때 분모는 상수이므로 다음과 같이 쓸 수 있다.

$$
P(\theta|y) \propto P(y|\theta)P(\theta)
$$

이때 우리가 구하고자 하는 것은 가장 높은 확률을 가지는 $\theta$이다. 이러한 문제를 최대사후확률 추정(maximum a posteriori estimation)이라고 한다.
이때 앞서 언급한 것과 같이 $P(y|\theta)$는 알려져있으나 $P(\theta)$는 알려져있지 않다. 이것은 모수의 사전확률이며, 이 경우에는 시스템 모델과 측정 모델, 그리고 초기 상태가 있을 법한 범위를 의미한다. 일반적으로는 이것이 전혀 알려져있지 않으므로 이것을 uniform distribution 또는 분산이 무한대인 정규분포로 가정한다. 그렇게 할 경우 이 문제는 가능도(likelihood), 즉 $P(y|\theta)$를 최대화하는 $\theta$를 찾는 문제로 바뀌게 되며, 이 경우를 최대가능도추정(maximum likelihood estimation)이라고 한다.

그런데 다행스럽게도 우리 시스템에서는 시스템 모델과 측정 모델의 범위를 대강이나마 알고 있다. 예를 들어 pendulum 시스템을 튜닝하려는 경우, 막대의 길이를 정밀하게 알지는 못하지만 수 센티미터 이내의 오차로 측정하는 것은 간단한 일이며, 중력가속도 역시 아무리 오차를 크게 잡더라도 적어도 9에서 11 사이임을 알고 있다. 또한 센서의 bias나 scale 역시 완벽한 값을 알지는 못하더라도 대략 측정 한계의 10%정도 범위 내에 있다는 것 정도는 확신할 수 있다.

뿐만 아니라 초기 상태에 있어서도 대강의 속도나 각도는 추정할 수 있으며, 그것이 어려우면 그냥 충분히 큰 범위를 잡거나 유한한 도메인을 가진 측정값(e.g. 각도)의 경우 정의역 전체의 균등분포를 가정하면 된다. 그러므로 이러한 전제조건 하에서 최대사후확률추정을 시행하면 된다.

또한 앞서 고민했던 측정 가능성에 대한 이론 역시 여기에서 쉽게 해결된다. 이러한 시스템은 자명히 불능일 수는 없고, 이것이 부정이면, 즉 같은 최댓값을 갖도록 하는 parameter가 무수히 많으면, 일반적으로는 그러한 parameter들의 조합이 무수히 많으면, 이 경우 이러한 시스템은 trainable하지 않는다.

---

그러면 이제 이것의 현실적인 solution을 고안하자. 먼저 시스템의 확률공간이 유한집합인 경우, 시스템 모델은 간단히 행렬로 주어지기 때문에 계산이 무척 간단해진다. 그러므로 가능한 경우 항상 이 방법을 택해야 한다. 시스템의 확률공간이 연속인 경우에도 그리드로 근사하여 이 방법을 적용할 수 있다.

만약 이것이 가능하다면 state transition은 $S_{t+1} = A S_t$로 주어지며, observation은 $O_t = C  S_t$로 주어진다. 이때 S, O가 대문자인 이유는 이것이 하나의 값을 나타내는 것이 아니라 모든 가능한 값에 대한 확률을 담고 있는 벡터이기 때문이다.

==> 이 방법이든 아니면 연속확률밀도를 적당히 근사하는 방법이든, 파티클 필터와 같이 importance sampling 방법을 사용하든, 어차피 확률분포의 진행을 하기는 해야 한다. 그 경우 s_0로부터 순서대로 진행하면 된다. 그러면 일종의 dp로 연산을 아낄 수 있다.

---

이제 마지막으로 결정해야 하는 것은 $P(y|\theta)$의 계산이다. 이것은 결국은 $P(y_{0:t}|\theta)$를 말하는 것이다. 여기에서 고려해야 할 점은 각 y에 대하여 함부로 독립 확률분포를 가정하면 안 된다는 것이다. 예를 들어 정규분포 X에 대하여 (X, -X)로 주어지는 확률변수 벡터를 생각해보자. 이것은 각 요소는 모두 정규분포이지만 공분산이 0이 아니기 때문에 독립을 가정할 수 없고, 따라서 이로부터의 샘플을 잘못 계산하면 매우 다른 결과를 얻게 된다. 예를 들어 1, 1은 애초에 이 확률분포에서는 나올 수 없는 샘플이지만 (그러므로 확률은 0) 각 요소를 독립이라고 가정해버리면 이러한 샘플은 양의 확률밀도를 가질 것이다.

그렇다면 간단한 케이스로부터 이것이 실제로 어떤 영향을 줄 수 있는지를 고려해보자. 먼저 초기 상태 $s0$와 시스템 모델 $A+b$, 관측 모델 $C+d$에 대하여, $b$, $d$는 각각 독립인 정규분포 잡음이라고 하자. 이 경우 첫 번째 관측값과 두 번째 관측값은 각각 다음과 같이 주어진다.

$$
\begin{align*}
y_0 &= C(A s_0 + b_1) + d_1 \\
y_1 &= C(A(A s_0 + b_1) + b_2) + d_2\\
&= C(A^2 s_0 + Ab_1 + b_2) + d_2
\end{align*}
$$

여기서 알고자 하는 것은 $y_0$과 $y_1$이 독립인지이다. 이것은 $y_0$과 $y_1$의 공분산이 0인지를 보면 된다. 이것은 다음과 같이 주어진다.

$$
\begin{align*}
\text{cov}(y_0, y_1) &= \text{cov}(C(A s_0 + b_1) + d_1, C(A^2 s_0 + Ab_1 + b_2) + d_2) \\
&= \text{cov}(CA s_0 + Cb_1 + d_1, CA^2 s_0 + CAb_1 + Cb_2 + d_2) \\
\end{align*}
$$

여기서 $s_0$는 상수이며 $b_1, b_2, d_1, d_2$는 독립이므로 다음과 같이 풀 수 있다.

$$
\begin{align*}
\text{cov}(y_0, y_1) &= \text{cov}(CA s_0 + Cb_1 + d_1, CA^2 s_0 + CAb_1 + Cb_2 + d_2)\\
&= \text{cov}(Cb_1 + d_1, CAb_1 + Cb_2 + d_2) \\
&= \text{cov}(Cb_1, CAb_1) + \text{cov}(Cb_1, Cb_2) + \text{cov}(Cb_1, d_2) + \text{cov}(d_1, CAb_1) + \text{cov}(d_1, Cb_2) + \text{cov}(d_1, d_2) \\
&= \text{cov}(Cb_1, CAb_1)\\
&= C\text{cov}(b_1, b_1)A^TC^T \\
&= C\Sigma_b A^TC^T\\
&\neq I
\end{align*}
$$

그러므로 이 경우 $y_0$과 $y_1$은 독립이 아니다. 이것은 각 요소가 독립이라고 가정하면 안 된다는 것을 보여준다.

일반화하여, 확률변수 $X$에 대하여 $AX$와 $BX$의 공분산은 다음과 같이 주어진다.

$$
\text{cov}(AX, BX) = A\Sigma_X B^T
$$

물론 이 내용은 해석적으로 확률분포에 접근할 때의 가정이며, 파티클 필터와 같이 importance sampling에 기반한 접근 방법을 쓸 때는 각 $\hat y$들을 서로 독립된 확률분포로 간주하지 않고 그 결합된 벡터의 분포를 근사하는 것으로만 생각하면 된다.

---

이런 방법을 사용할 때 미지수가 너무 많을 수 있다. 괜찮은 방법 중 하나는 EM 방법을 사용하는 것인데, 이것은 파라매터로 결정되는 확률분포에 대하여 하나의 파라매터를 고정하는 것과 같은 효과를 가진다.

---

외부 입력 $u_t$를 고려할 때는 그것 역시 미지수로 포함하면 된다.

---

이로부터 정말로 임의의 외력을 받는 시스템에 대해 그 파라매터를 조사하여보자.

- 간단히 생각해서 센서는 적어도 4개, 그러므로 그 scale과 bias에 대해 8개의 파라매터가 추가된다.
- input+state vector의 사이즈는 각도, 각속도, 각가속도다. 그러므로 초기 상태 중 입력인 각가속도를 제외하고 2개의 파라매터가 추가된다.
- 각 time step 별로 각가속도가 state에 반영된다. 그러므로 t개의 파라매터가 추가된다.
- state transition 시 평균이 0인 정규분포 잡음을 가정하면 3\*3 공분산 행렬이 추가되는데, 이때 대칭행렬이므로 6개의 파라매터가 추가된다.
  - 만약 분산을 제외한 공분산이 모두 0이라 가정하면 3개의 파라매터가 추가된다.
- 관측 시에 4개의 센서에 대해 평균이 0인 정규분포 잡음을 가정하면 4\*4 공분산 행렬이 추가되는데, 이때 대칭행렬이므로 10개의 파라매터가 추가된다.
  - 만약 분산을 제외한 공분산이 모두 0이라 가정하면 6개의 파라매터가 추가된다.
- 여기에 모델 자체의 파라매터인 회전반지름과 중력가속도를 추가하면 2개의 파라매터가 추가된다.
  - 중력가속도를 상수로 고정하면 1개의 파라매터가 추가된다.

정리하면 최소 8+2+t+3+6+1=20+t개, 최대 8+2+t+6+10+2=28+t개의 파라매터가 필요하다.

---

이것을 어떻게 처리할 수 있는지는 상당히 큰 문제다. t 파라매터는 사실 state를 곧바로 통과하여 observation으로 가기 때문에 무척 좁은 공간상에 분포한다. 그래서 큰 문제가 되지 않는다.
그러나 나머지 파라매터들은 정말로 20차원이 넘는 공간상에 분포하게 되어서, 이것은 상당히 큰 문제가 된다. 각 차원에서 5개씩만 샘플을 뽑아도 3^20개의 샘플이 필요하게 된다. 이것은 약 14자리나 되는 무척 큰 숫자다.
특히 이보다 더 복잡한 시스템에서 만약 미지수가 30자리나 40자리를 넘어가게 된다면 이것은 사실상, 모든 가능성을 따져보는 종류의 수치적 탐색법으로는 푸는 것이 불가능한 문제가 된다.
물론 시스템이 closed-form solution을 가지지 못한 경우 이러한 방법을 사용할 수밖에 없지만, 만약 시스템이 해석적으로 최대나 최소를 찾을 수 있는 경우에는 해석적인 방법을 사용하는 것이 좋을 것이다.

---

임의의 시스템을 이러한 방법으로 분석할 때 할 수 있는 가장 합리적인 가정은 closed-form인 비선형 시스템과 가우시안 잡음을 가정하는 것이다. 선형 시스템 가정은 정말로 시스템이 선형인 경우 말고는 하기 어려운데, 왜냐하면 분산이 충분히 작은 경우라면 시변 선형 시스템으로 근사할 수 있겠지만, 일반적으로 공분산이 그렇게 작은 경우는 많지 않기 때문에 비선형 시스템을 선형으로 근사하면 오차가 커진다. 특히 sin과 같이 값의 범위를 강하게 제한하는 경우 더욱 문제가 커진다. 그런데 문제는 비선형 시스템과 가우시안은 결합하기가 쉽지 않다는 것이다. 그러므로 이것은 일종의 nonlinear filtering algorithm과 같은 문제점을 안고 있다. 이러한 문제를 해결하기 위해서는다음과 같은 개념들을 살펴볼 필요가 있다.

- Projection Filter
- Extended Kalman Filter
- Fokker–Planck equation

---

그런데 만약 상태 추정을 필터와 같은 식으로 진행하면 어떻게 되는가? 만약 비선형 모델을 가정한다면 정규분포 잡음에 state를 곱하는 것이 가능해지고, 그렇다면 정규분포 잡음의 평균과 분산을 state에 집어넣는, 괴상한 일이 가능해진다. 마찬가지로, 잘만 하면 모델의 파라매터 자체도 state에 넣을 수 있는 것이다.

만약 그렇다면, 이로부터 다음과 같은 모델을 얻게 된다.

$$
\begin{align*}
s_{t+1} &= f(s_t, u_t, \theta_s, w_s) \\
y_t &= g(s_t, \theta_o,  w_o)
\end{align*}
$$

이때 $w_s$와 $w_o$는 각각 $N(0, 1)$의 표준정규분포를 따르는 잡음이며, $\theta_s$와 $\theta_o$는 각각 state와 observation에 대한 상수 파라매터다. 이때 f와 g는 시간을 포함하여 그 어떤 파라매터도 없는 순수 함수임을 유의해야 한다. 또한 가변적인 부분에 대한 극단적인 집중을 위해서는 다음과 같이 $g$의 파라매터를 시스템 모델 안에 넣을 수도 있다.

$$
\begin{align*}
s_{t+1} &= f(s_t, u_t, \theta_s, w_s, \theta_o, w_o) \\
y_t &= g(s_t)
\end{align*}
$$

먼저 이러한 parameter-merged 모델이 합리적인지를 알아보자. 먼저 초기 state에서 state의 분포와 확률분포의 모수를 포함한 fixed parameter의 분모는 분명히 독립이다. 왜냐하면 state의 분포는 prior이기 때문이다. 이때 중요한 것은 fixed parameter라는 것은 invariant지만, 불확실성에 의해 분포가 된다는 것이다.

그리고 system model을 통한 transition의 경우 fixed parameter의 분포는 변함이 없다. 왜냐하면 그것이 fixed parameter의 정의이기 때문이다. 반면 state의 분포는 변해야 하는데, 이때 fixed parameter의 분포가 여기에 영향을 준다. 이것이 어떻게 state의 확률분포에 영향을 주는지는 무척 중요하다. 먼저 시스템에 포함된 길이나 질량과 같은, 시불변인 파라매터, 즉 non-stochastic parameter(NSP) 를 살펴보자. state의 확률분포가 $p_s(s)$로 주어지고, 어떤 NSP $\theta$의 확률분포, 이 경우 prior가 $p_\theta(\theta)$로 주어진다고 하자. 이때 state와 NSP가 결정되었다고 가정할 때의 transition function이 $f$라고 하면, 이때 state의 확률분포는 다음과 같이 주어진다.

$$
p_{s_{t+1}}= \int p_s(s) \int p_\theta(\theta) \delta(s - f(s, \theta)) d\theta ds
$$

---

위와 같은 해석적 접근은 확률분포가 넓은 범위에 퍼져 있어 선형성이 깨지는 경우나 시스템이 크게 비선형적인 경우, 더군다나 시스템이 해석적이지 않은 경우에는 대단히 어렵다. 그러므로 확률분포를 적당히 근사하는 것이 필요하다. 이것을 일전에는 파티클 필터로서 해결하려고 시도했는데, 이때 실수로 시불변 파라매터에 시변성을 줌으로써 계산을 잘못하게 되었다.

이것은 머신러닝으로 접근하기도 어려운데, 왜냐하면 각종 파라매터들이 무척 복잡하고 재귀적으로 얽혀있기 때문이다. 따라서 단순히 back-propagation을 적용하는 경우 계산 그래프가 무척이나 길어지게 된다.

입력이 주어지지 않을 때 출력을 추정하는 것은 시간에 무관하거나, 약간 연관 있는, 즉, 직전 입력과의 상관이 절대적이지는 않지만 없지도 않은 input을 함께 추정하는 과정이다.
