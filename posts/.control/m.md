---
title: 'Path 추종형 로봇 제어'
category: embedded 
date: 

---

우리 학교 로봇 동아리 ZETIN 회원들을 위하여 주로 개발하는 차동제어형 로봇에서 스텝모터 제어 시 탈조를 방지하기 위한 방법을 정리한다.

## 모델링

로봇 제어를 올바르게 설계하기 위해서는 시스템의 모델링이 중요하다. 똑같은 시스템을 모델링하더라도 그 방식에 따라 해석의 난이도와 구현의 난이도가 달라진다.

Path 추종형 로봇 제어, 즉 라인트레이서의 경우 다양한 방식으로 모델링할 수 있다.
- 예를 들어 시간 변수를 포함시켜 속도, 가속도, 위치를 $v(t), a(t), x(t)$ 등으로 나타낼 수 있다.
- 또는 속도와 가속도를 거리에 대한 함수 $v(x), a(x)$로 나타낼 수도 있다.

이때 직관적이기는 전자의 방식이 직관적이지만, 제어에 중요한 곡률 값이 출발 지점으로부터의 거리에 따라 주어지기 때문에 실제로 해석해보면 후자가 훨씬 편하다. 따라서 이 글에서는 후자의 방식으로 모델링을 진행한다.

구체적으로
- 전자의 방식은 제어 시 `출발 이후 특정 시점에 특정 위치에 있도록` 제어하는 것이다.
- 반면 후자의 방식은 `특정 위치에서 속도와 가속도가 특정 값이 되도록` 제어하는 것이다.

실제로는 같은 제어 방식이지만 후자의 방식이 더 해석하기 쉽다.


차동제어형 로봇에 대하여 다음과 같이 변수를 모델링한다.
- $x$: Path의 시작 지점으로부터 path를 따라 이동한 거리
- $v(x)$: 로봇 중심의 위치에 따른 속도
- $a(x)$: 로봇 중심의 위치에 따른 가속도
- $r(x)$: 로봇 중심의 위치에 따른 곡률 (우측 곡률을 양수로 둔다.)
- $d$: 로봇의 중심으로부터 바퀴까지의 거리 (즉 양 바퀴 사이의 거리는 $2d$)

이때 직접 제어할 수 있는 값은 $a(x)$ 뿐이고 $v(x)$는 $a(x)$를 통하여 간접적으로 제어할 수 있다. 추종할 목적 함수는 $a(x)$나 $v(x)$둘 중 하나를 선택할 수 있는데, $v(x)$를 택한다. $a(x)$를 추종하는 경우 $v(x)$는 $a(x)$를 적분한 값이 되기 때문에 오차가 누적되어 $v(x)$가 불안정해지기 때문이다. 단 이렇게 하면 $a(x)$를 완벽히 추종할 수 없기 때문에, 어느정도 안전률을 두어야 한다.

이때 $v(x)$와 $a(x)$의 관계를 유의해야 한다. 파라매터가 시간이 아닌 위치이기 때문에 $\frac{dv}{dx} = a(x)$가 아니기 때문이다. 이러한 모델링 하에서 $v(x)$와 $a(x)$는 다음과 같은 관계를 가진다.
$$
\begin{align}
v &= \frac{dx}{dt} \\
\therefore dt &= \frac{dx}{v} \\
\therefore  a(x) &= \frac{dv}{dt} = \frac{dv}{dx} v
\end{align}
$$

익숙하지 않은 표현 방법이므로, 이해를 돕기 위해서 등가속도운동을 예제로 확인해보자.
- 가속도를 $a$라 두자.
- $v(t) = at$, $x(t) = \frac{1}{2}at^2$이다.
- 두 번째 식을 $t$에 대해 풀면 $t=\sqrt{\frac{2x}{a}}$이다.
- 이를 첫 번째 식에 대입하면 $v(x) = \sqrt{2ax}$이다.
- 식 3이 옳은지 검산해보면 $a(x) = \frac{dv}{dx} v = \frac{a}{\sqrt{2ax}} \sqrt{2ax} = a$임을 확인할 수 있다.

이로부터 간단한 기하학을 적용하여 각 바퀴의 속도 $v_r$와 $v_l$을 다음과 같이 나타낼 수 있다.

$$
\begin{align}
v_r &= v (1 - dr) \\
v_l &= v (1 + dr)
\end{align}
$$

식 4, 5에 식 3을 적용하여 $a_r$과 $a_l$을 나타내면 다음과 같다. 이때 r 역시 x에 대한 함수임에 유의하여야 한다.

$$
\begin{align}
a_r &= \frac{dv_r}{dx}v_r = \left(v'(1-dr) - vdr'\right)v(1-dr)\\
a_l &= \frac{dv_l}{dx}v_l = \left(v'(1+dr) + vdr'\right)v(1+dr)
\end{align}
$$

이때 $a(x)$를 완벽히 제어할 수 있다면 이러한 문제를 풀 필요가 없을 것이다. 그러나 실제로는 모터에서 인덕턴스로 인하여 코일이 여자되는 시간이 있기 때문에 속도가 증가함에 따라 토크가 감소한다. 이때 속도에 대한 최대 토크를 $T(v)$라 하자. 그러면 바퀴의 가속도와 토크는 비례 관계를 가지므로 적당한 비례 상수 $k$를 곱하여 최대 가속도를 $a_{max}=kT(v)$로 둘 수 있다.

## 시스템 해석

이로부터 다음과 같은 미분부등식을 세울 수 있다.

$$
\begin{align}
\left|a_r\right| &= \left|(v'(1-dr) - vdr')v(1-dr)\right| \leq kT(v) \\
\left|a_l\right| &= \left|(v'(1+dr) + vdr')v(1+dr)\right| \leq kT(v)
\end{align}
$$

이때 현재의 $v$, $r$이 주어졌을 때, 위 부등식을 만족하는 $v'$ 

---

$$
-\frac{d\,v\left(x\right)\,\frac{\partial }{\partial x} r\left(x\right)-\frac{y\,{\mathrm{e}}^{u\,1{}\mathrm{i}}}{v\left(x\right)\,\left(d\,r\left(x\right)-1\right)}}{d\,r\left(x\right)-1}
$$